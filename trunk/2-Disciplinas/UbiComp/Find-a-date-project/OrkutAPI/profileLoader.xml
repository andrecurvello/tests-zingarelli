<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Profile Loader" 
    description="This app loads fields that are available for a profile" 
    author="Matheus Ricardo Uihara Zingarelli">
  <Require feature="opensocial-0.8"/>
</ModulePrefs>

<Content type="html">
  <![CDATA[
  <script type="text/javascript">
    //fetch data from user's profile	
    function loadProfile() {
       var req = opensocial.newDataRequest();
   
      //fields we are interested to get data from
      var params = {};
      params[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS] = 
        [opensocial.Person.Field.THUMBNAIL_URL,
	 opensocial.Person.Field.GENDER,
         opensocial.Person.Field.RELATIONSHIP_STATUS,
         opensocial.Person.Field.CURRENT_LOCATION,
	 opensocial.Person.Field.LANGUAGES_SPOKEN,
	 opensocial.Person.Field.HUMOR,
	 opensocial.Person.Field.FASHION,
         opensocial.Person.Field.INTERESTS,
	 opensocial.Person.Field.SPORTS,
	 opensocial.Person.Field.ACTIVITIES,
	 opensocial.Person.Field.BOOKS,
         opensocial.Person.Field.MUSIC,
         opensocial.Person.Field.TV_SHOWS,
         opensocial.Person.Field.MOVIES,
         opensocial.Person.Field.FOOD,
         opensocial.Person.Field.STATUS,
         opensocial.Person.Field.TURN_ONS,
         opensocial.Person.Field.TURN_OFFS,
         opensocial.Person.Field.ROMANCE];
    
      req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER, params), 'viewer');   

      req.send(onLoadProfile);
    }

    //display data from user's profile
    function onLoadProfile(data) {    
      var viewer = data.get('viewer');
    
      if(!viewer.hadError()){
        var viewerData = viewer.getData();
	
        //CURRENT_LOCATION is an opensocial.Address object
        var address = viewerData.getField(opensocial.Person.Field.CURRENT_LOCATION);
            
        html = new Array();
        html.push('Dados do perfil a serem usados no matching');
        html.push('<ul>');
        html.push('<li><strong>Sexo: </strong>', viewerData.getField(opensocial.Person.Field.GENDER).getDisplayValue(), '</li>');
        html.push('<li><strong>Estado Civil: </strong>', viewerData.getField(opensocial.Person.Field.RELATIONSHIP_STATUS), '</li>');
        html.push('<li><strong>Endereço: </strong>', address.getField(opensocial.Address.Field.LOCALITY), ', ', address.getField(opensocial.Address.Field.REGION), ', ', address.getField(opensocial.Address.Field.COUNTRY), '</li>');
        html.push('<li><strong>Línguas que eu falo: </strong>', viewerData.getField(opensocial.Person.Field.LANGUAGES_SPOKEN), '</li>');
        html.push('<li><strong>Humor: </strong>', viewerData.getField(opensocial.Person.Field.HUMOR), '</li>');
        html.push('<li><strong>Estilo de vestir: </strong>', viewerData.getField(opensocial.Person.Field.FASHION), '</li>');
        html.push('<li><strong>Paixões: </strong>', viewerData.getField(opensocial.Person.Field.INTERESTS), '</li>');
        html.push('<li><strong>Esportes: </strong>', viewerData.getField(opensocial.Person.Field.SPORTS), '</li>');
        html.push('<li><strong>Atividades: </strong>', viewerData.getField(opensocial.Person.Field.ACTIVITIES), '</li>');
        html.push('<li><strong>Livros: </strong>', viewerData.getField(opensocial.Person.Field.BOOKS), '</li>');
        html.push('<li><strong>Músicas: </strong>', viewerData.getField(opensocial.Person.Field.MUSIC), '</li>');
        html.push('<li><strong>TV: </strong>', viewerData.getField(opensocial.Person.Field.TV_SHOWS), '</li>');
        html.push('<li><strong>Filmes: </strong>', viewerData.getField(opensocial.Person.Field.MOVIES), '</li>');
        html.push('<li><strong>Comida: </strong>', viewerData.getField(opensocial.Person.Field.FOOD), '</li>');
        html.push('<li><strong>Gosto de: </strong>', viewerData.getField(opensocial.Person.Field.TURN_ONS), '</li>');
        html.push('<li><strong>Nao gosto de: </strong>', viewerData.getField(opensocial.Person.Field.TURN_OFFS), '</li>');
        html.push('<li><strong>Par ideal: </strong>', viewerData.getField(opensocial.Person.Field.ROMANCE), '</li>');       
        html.push('</ul>');
        html.push('Dados do perfil para exibição:');   
        html.push('<p><img src="', viewerData.getField(opensocial.Person.Field.THUMBNAIL_URL), '" />&nbsp;<strong>', viewerData.getDisplayName(), '</strong></p>');
        html.push('<p><strong><em>', viewerData.getField(opensocial.Person.Field.STATUS), '</em></strong></p>');       
        html.push('<ul>');
        html.push('<li><strong>Gosto de: </strong>', viewerData.getField(opensocial.Person.Field.TURN_ONS), '</li>');
        html.push('<li><strong>Nao gosto de: </strong>', viewerData.getField(opensocial.Person.Field.TURN_OFFS), '</li>');
        html.push('<li><strong>Par ideal: </strong>', viewerData.getField(opensocial.Person.Field.ROMANCE), '</li>');       
        html.push('</ul>');        
        document.getElementById('perfil').innerHTML = html.join('');
      }
      else{
        document.getElementById('perfil').innerHTML = 'Erro no recebimento de dados do perfil';
      }
    }

    function init() {
      loadProfile();
    }

    gadgets.util.registerOnLoadHandler(init);
  </script>
  <div id='main'>
    <div id='perfil'></div>
  </div>
  ]]>
</Content>
</Module>

