<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<ModulePrefs title="Load info of friends of friends" description="This is an app for testing fetching my friends data" author="Matheus Ricardo Uihara Zingarelli">
		<Require feature="opensocial-0.8"/>
		<Require feature="dynamic-height" />
	</ModulePrefs>
	<Content type="html">
		<![CDATA[
			<script type="text/javascript">
				function loadFriends() {
					var req = opensocial.newDataRequest();
					
					//use this to fetch data for a single person ID, the viewer on this case
					//the 'viewer' is a key to access all data fetched for the person ID (viewer)
					req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER), 'viewer');

					//an IdSpec is required to fetch a group of people
					//this IdSpec will contain data of FRIENDS for the VIEWER
					var viewerFriends = opensocial.newIdSpec({ "userId" : "VIEWER", "groupId" : "FRIENDS" });
					//set a maximum of data to be fetched and get profile Thumbnail
					var opt_params = {};
					opt_params[opensocial.DataRequest.PeopleRequestFields.MAX] = 150;
					opt_params[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS] = [opensocial.Person.Field.THUMBNAIL_URL];
				        req.add(req.newFetchPeopleRequest(viewerFriends, opt_params), 'viewerFriends');

					//onLoadFriends is a callback for the javascript function of the same name
					req.send(onLoadFriends);
				}

				//data on this case is what was fetched from loadFriends
				function onLoadFriends(data) {
					var viewer = data.get('viewer').getData();
					var viewerFriends = data.get('viewerFriends').getData();
					
					html = new Array();
					html.push('<ul>');
					viewerFriends.each(function(person) {
						if (person.getId()) {
							html.push('<li><img src="', person.getField(opensocial.Person.Field.THUMBNAIL_URL), '" />', person.getDisplayName(), '</li>');
						}
					});
					html.push('</ul>');
					document.getElementById('friends').innerHTML = html.join('');
					gadgets.window.adjustHeight();
				}

				function init() {
					loadFriends();
				}

				gadgets.util.registerOnLoadHandler(init);
			</script>
			<div id='main'>
				Your friends:
				<div id='friends'></div>
			</div>
		]]>
	</Content>
</Module>

